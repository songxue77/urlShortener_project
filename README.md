# 단축URL 프로젝트

## 프로젝트 개요

단축 URL서비스를 직접 운영하여 단축URL 관리의 용이함, 데이터의 마케팅활용을 기대 

## 프로젝트 수행기간

2021.07.19 ~ 2021.08.20 (5주, 8월 첫째주 여름휴가 다녀와서 실제 작업시간은 4주)

## 프로젝트 수행 상세

1. PHP기반의 오픈소스 검토 (YOURLS, polr, shorty)
2. YOURLS는 MVC 구조가 아니고 파악하기 힘들어서 제외
3. shorty는 파일 3개로 구성된 마이크로 프로젝트였으며 프레임워크 기반으로 만들고자 생각하여 제외
4. polr는 lumen기반이였으며 기존에 많이 다루던 라라벨과 유사하여 채택
5. 오픈 되어있는 단축URL프로젝트와 다르게 회사 내부에서만 사용할 예정이기에 기존 내부 CMS 시스템에 단축URL 등록 기능, 통계 기능 탑재
   1. 단축URL코드(예: 9ncRqs)를 생성하는 알고리즘 검토. 
      중복되지 않는 코드를 생성하기 위해 10진수를 62진수로 바꾸는 알고리즘이 제일 적당하다고 생각. 
      하지만 요구사항은 6자리 코드만 사용.
      Mysql의 auto increment는 절대 중복되지 않는다고 가정하고 auto increment를 활용하려고 하였지만 DBA와 상의한 결과 서비스 규모가 그렇게 클것 같지 않고 랜덤함수를 사용하여 생성해도 큰 문제가 없다고 판단. (1,2,3,4,5자리는 배제해야 하기 때문에 auto increment를 사용시 auto increment값의 default를 정의해야 했음.)
      최종적으로 array_shuffle을 이용하여 랜덤 문자열을 생성하는것으로 결정
   2. 유저를 redirect해주는 코드를 어떻게 구성할지 검토. 
      일정에 차질이 없기 위해 제일 안전한 웹서버 형식의 코드를 미리 짜놓았음(PHP). 
      AWS의 serverless를 사용해볼까 해서 추가로 python flask를 기반으로 코드를 짜놓고 lambda에 업데이트할려고 했지만 
      lambda함수는 생각했던것보다 다른 방식으로 동작한다는걸 인지.
      (웹서버에 요청이 들어와서 python에 전달하여 처리하는게 아닌.. APIGateway로 요청을 받고 lambda에서 처리를 하고 다시 리턴해주는 방식). 
      이미 만들어놓은 flask애플리케이션을 lambda에 활용할 수 있을가 구글링을 하면서 zappa 서비스 발견. 
      적용해보니 제대로 동작. 문서가 너무 적어서 실제 문제가 발생했을때 디버깅하기 어려울꺼라 판단하고 다른 대안을 찾아봄.
      serverless framework라는 nodejs기반의 솔루션 발견. 
      구글링 시 한페이지 정도의 문서와 정리글들이 있었으며 하루종일 삽질해서 애플리케이션을 업로드했지만 제대로 동작하지 않음.
      (집에서 Mac으로 배포했을 때는 제대로 동작했으나 회사 Windows컴에서는 오류 발생)
      github이슈에 등록된 글이나 블로그를 확인해보았을때 어느정도 사용하고 있기는 하나 문서가 역시 부족함.
      특정 이슈는 1,2년이 지나도 수정이 되어있지 않다.
      중요한 서비스이기에 적용하기 불적합하다고 판단.
      결국 기존에 짜놓은 PHP기반 lumen프로젝트를 웹서버와 같이 돌려서 서비스하기로 결정.

## 느낀점

1. serverless를 사용해보겠다고 새로운 언어(python)와 환경(apigateway + lambda)에 신규 프로젝트를 구현할려고 하니 어려움을 많이 느꼈음. 일정을 맞추기 위해 가장 자신있는 언어로 개발할 수 밖에 없었음.
2. Laravel, JQuery기반의 백오피스는 이제 빠른 속도로 개발할 수 있다. 
   뭔가 새로운 시도 (React,Vue등 프런트엔드를 Admin에 적용 OR 기존 코드 리팩토링 OR 테스트코드 작성) 가 필요한 시점인 것 같다.
3. MVC로 개발된 코드가 아니면 파악하기 어렵다는 것을 느꼈다. (대표적으로 YOURLS의 코드)

## 프로젝트 코드

현재 저장소에 업로드한 로직은 python으로 작성한 (serverless용) 유저를 리다이렉팅 시키는 코드이다.
기존 코드는 회사 내부 사정때문에 공개불가.

## Github Repository Link (부분코드)

github.com/songxue77/urlShortener_project
